-- barangay_profiling_db.sql

CREATE DATABASE IF NOT EXISTS barangay_profiling_db;
USE barangay_profiling_db;

-- Table 1: PROFILE
CREATE TABLE profile (
    resident_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    household_id INT(10),
    first_name VARCHAR(18) NOT NULL,
    middle_name VARCHAR(18),
    last_name VARCHAR(18) NOT NULL,
    suffix VARCHAR(3),
    birth_date DATE NOT NULL,
    gender ENUM('M','F','O') NOT NULL,
    civil_status ENUM('Single','Married','Widowed','Separated') NOT NULL,
    nationality VARCHAR(20),
    religion VARCHAR(20),
    occupation VARCHAR(20),
    educational_attainment VARCHAR(30),
    social_status ENUM('Employed','Unemployed','Student','Senior Citizen','PWD'),
    FOREIGN KEY (household_id) REFERENCES household(household_id) ON DELETE SET NULL
);

-- Table 2: CONTACT INFORMATION
CREATE TABLE contact_information (
    contact_no VARCHAR(11) PRIMARY KEY,
    email VARCHAR(20),
    residency_status ENUM('Active','Deceased','Moved Out') DEFAULT 'Active',
    date_registered DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    registered_by INT(10),
    resident_id INT(11) UNIQUE,
    FOREIGN KEY (resident_id) REFERENCES profile(resident_id) ON DELETE CASCADE,
    FOREIGN KEY (registered_by) REFERENCES account(account_id) ON DELETE SET NULL
);

-- Table 3: HOUSEHOLD / ADDRESS INFORMATION
CREATE TABLE household (
    household_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    house_no VARCHAR(10),
    street VARCHAR(20),
    purok VARCHAR(10),
    barangay VARCHAR(15),
    city VARCHAR(20),
    province VARCHAR(20),
    zipcode CHAR(4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table 4: ACCOUNT
CREATE TABLE account (
    account_id INT(10) AUTO_INCREMENT PRIMARY KEY,
    resident_id INT(10) UNIQUE,
    role_id INT(10),
    dept_id INT(10),
    username VARCHAR(15) UNIQUE NOT NULL,
    password_hash VARCHAR(100) NOT NULL,
    status ENUM('Active','Inactive') DEFAULT 'Active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL,
    FOREIGN KEY (resident_id) REFERENCES profile(resident_id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(role_id) ON DELETE SET NULL,
    FOREIGN KEY (dept_id) REFERENCES department(dept_id) ON DELETE SET NULL
);

-- Table 5: ROLES
CREATE TABLE roles (
    role_id INT(10) AUTO_INCREMENT PRIMARY KEY,
    role_name VARCHAR(20) NOT NULL UNIQUE
);

-- Table 6: DEPARTMENT
CREATE TABLE department (
    dept_id INT(10) AUTO_INCREMENT PRIMARY KEY,
    dept_name VARCHAR(30) UNIQUE NOT NULL
);

-- Table 7: ACTIVITY_LOG
CREATE TABLE activity_log (
    log_id INT(10) AUTO_INCREMENT PRIMARY KEY,
    profile_id INT(10),
    account_id INT(10),
    action_type ENUM('Add','Update','Delete','View','Login') NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    remarks VARCHAR(100),
    FOREIGN KEY (profile_id) REFERENCES profile(resident_id) ON DELETE SET NULL,
    FOREIGN KEY (account_id) REFERENCES account(account_id) ON DELETE SET NULL
);

-- Insert default data
INSERT INTO roles (role_name) VALUES ('Admin'), ('Staff'), ('Viewer');
INSERT INTO department (dept_name) VALUES ('Barangay Office'), ('Health Center'), ('Treasury');

-- Create default admin account (password: admin123)
INSERT INTO profile (first_name, last_name, birth_date, gender, civil_status) 
VALUES ('System', 'Administrator', '1990-01-01', 'M', 'Single');

INSERT INTO account (resident_id, role_id, dept_id, username, password_hash, status) 
VALUES (1, 1, 1, 'admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'Active');
